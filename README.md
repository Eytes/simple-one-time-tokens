# Одноразовые токены

Этот сервис предоставляет API для создания одноразовых токенов доступа. Запрос на создание токена возможен только с доверенных IP-адресов. Сервис проверяет переданные токены, автоматически удаляя использованные или просроченные.

## Функционал

- Генерация одноразовых токенов с заданным временем жизни.
- Проверка токенов с их автоматическим уничтожением при успешной валидации.
- Очистка просроченных токенов.
- Health-check эндпоинт.

## Структура проекта

Проект использует следующую структуру:
```text
.
├── .dockerignore                      # Файлы и папки, игнорируемые Docker при сборке образа
├── .env.example                       # Пример переменных окружения для локальной настройки
├── .python-version                    # Указание версии Python для среды разработки
├── docker-compose.yaml                # Конфигурация для запуска проекта и зависимостей через Docker Compose
├── Dockerfile                         # Инструкции для сборки Docker-образа проекта
├── pyproject.toml                     # Управление зависимостями и настройками проекта
├── README.md                          # Документация по проекту: как запускать, настраивать и использовать
├── src                                # Основной каталог с исходным кодом приложения
│   ├── db                             # Работа с базой данных
│   │   └── tokens.py                  # Логика хранения и управления токенами
│   ├── dependencies                   # Зависимости для DI (FastAPI Depends)
│   │   ├── ip.py                      # Получение IP-адреса клиента
│   │   └── tokens.py                  # Зависимость для проверки или извлечения токена
│   ├── docs                           # Документация API и описание ответов
│   │   └── responses.py               # Стандартизированные ответы для эндпоинтов
│   ├── exceptions                     # Кастомные исключения
│   │   ├── access.py                  # Исключения, связанные с доступом
│   │   └── tokens.py                  # Исключения, связанные с токенами
│   ├── main.py                        # Точка входа в приложение. Инициализация FastAPI и подключение роутов
│   ├── routes                         # Определение маршрутов (эндпоинтов) API
│   │   ├── health.py                  # Эндпоинт проверки работоспособности сервиса
│   │   └── tokens.py                  # Эндпоинты для генерации, проверки и управления токенами
│   ├── schemas                        # Pydantic-схемы для сериализации и валидации данных
│   │   └── token.py                   # Схемы, связанные с токенами
│   └── settings.py                    # Загрузка и конфигурация переменных окружения, глобальные настройки
└── uv.lock                            # Файл блокировки зависимостей (созданный через uv)                 
```

## Установка

### 1. Клонирование репозитория

```shell
git clone https://github.com/Eytes/simple-one-time-links.git
cd one-time-links-api
```

### 2. Создание файла .env

Создайте файл .env для хранения конфиденциальных данных, например, для списка доверенных IP-адресов и других переменных окружения.

Пример содержания файла .env:

```shell
TRUSTED_IPS="192.168.1.1,192.168.1.2"
LINK_TTL_SECONDS=30
CLEANUP_INTERVAL=10
```

### 3. Запуск сервиса

```shell
docker-compose up --build
```

Теперь документация сервиса будет доступна по адресу http://localhost:8080/api/docs
