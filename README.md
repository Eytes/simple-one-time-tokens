# Одноразовые токены

Этот сервис предоставляет API для создания одноразовых токенов доступа. Запрос на создание токена возможен только с доверенных IP-адресов. Сервис проверяет переданные токены, автоматически удаляя использованные или просроченные.

## Функционал

- Генерация одноразовых токенов с заданным временем жизни.
- Проверка токенов с их автоматическим уничтожением при успешной валидации.
- Очистка просроченных токенов.
- Health-check эндпоинт.

## Структура проекта

Проект использует следующую структуру:
```text
.
├── .dockerignore                      # Список файлов и директорий, которые игнорируются при создании Docker-образа
├── .env.example                       # Пример файла .env, где указаны все необходимые переменные окружения
├── .python-version                    # Указание на версию Python для использования в виртуальном окружении
├── Dockerfile                         # Dockerfile для создания образа приложения
├── README.md                          # Этот файл с документацией
├── docker-compose.yaml                # Конфигурация для Docker Compose
├── pyproject.toml                     # Конфигурация зависимостей и настроек проекта (для Poetry или других менеджеров зависимостей)
├── src                                # Основной код проекта
│   ├── dependencies                   # Модуль с зависимостями, например, с функцией для получения IP клиента
│   │   ├── cleanup_expired_tokens.py  # Очистка истёкших токенов
│   │   └── get_client_ip.py           # Функция для получения IP клиента из запроса
│   ├── docs                           # Документация API, описание возможных ответов и статусов
│   │   └── responses.py               # Описание всех возможных ответов на эндпоинтах
│   ├── exceptions                     # Кастомные исключения для обработки ошибок (например, для доступа или ссылок)
│   │   ├── access.py                  # Исключение для отказа в доступе
│   │   └── links.py                   # Исключение для обработки ошибок с одноразовыми ссылками
│   ├── main.py                        # Основной файл с настройкой FastAPI приложения и подключением маршрутов
│   ├── routes                         # Все маршруты (эндпоинты) для работы с API
│   │   ├── health.py                  # Эндпоинт для проверки состояния сервиса (health check)
│   │   └── links.py                   # Эндпоинты для создания и проверки одноразовых ссылок
│   ├── schemas                        # Pydantic схемы для валидации запросов и ответов
│   │   └── link.py                    # Схемы для создания и проверки одноразовых ссылок
│   └── settings.py                    # Конфигурации и загрузка переменных окружения
└── uv.lock                  
```

## Установка

### 1. Клонирование репозитория

```shell
git clone https://github.com/Eytes/simple-one-time-links.git
cd one-time-links-api
```

### 2. Создание файла .env

Создайте файл .env для хранения конфиденциальных данных, например, для списка доверенных IP-адресов и других переменных окружения.

Пример содержания файла .env:

```shell
TRUSTED_IPS="192.168.1.1,192.168.1.2"
LINK_TTL_SECONDS=30
CLEANUP_INTERVAL=10
```

### 3. Запуск сервиса

```shell
docker-compose up --build
```

Теперь документация сервиса будет доступна по адресу http://localhost:8080/api/docs
